"""
Модуль для хранения текстовых шаблонов и вспомогательных функций сообщений бота.
"""

import re

# Условия вступления
TERMS_MESSAGE = """
Нажимая кнопку, вы подтверждаете, что:

– вы не бот
– согласны на обработку персональных данных
– согласны на получение важных новостей сообщества от бота
– вам исполнилось 18 лет

Чат — не медицинское сообщество и не оказывает квалифицированную помощь напрямую. Общение в чате не заменяет лечение, это лишь поддержка. Если вам тяжело, обратитесь к специалистам (они у нас есть). Вы сами отвечаете за последствия применения информации из чата. Фильтруйте её и используйте с умом. Мнения участников не формируют единую позицию. То, что помогло кому-то, вам может не помочь.
"""

def escape_markdown(text: str) -> str:
    """
    Экранирует специальные символы Markdown, чтобы избежать ошибок парсинга.
    """
    return re.sub(r'([_*\\[\\]()~`>#+\\-=|{}.!])', r'\\\\\\1', text or "")

def get_invite_links_text(links: list[tuple[str, str, str]]) -> str:
    """
    Формирует текст со списком приватных ссылок и дополнительной информацией.
    Аргумент links — список кортежей (title, invite_link, description).
    """
    # Вступительный абзац с корректной Markdown-ссылкой
    intro = (
        "*На данный момент, основной чат находится в режиме приватности и "
        "конфиденциальности участников. Но скоро это изменится, поэтому, если "
        "вы переживаете, [прочтите о том, как улучшить свою анонимность]"
        "(https://graph.org/Anonimnost-i-konfidencialnost-uchastnikov-05-31)*"
    )
    text = intro + "\n\n"
    # Приватные ссылки
    for title, link, description in links:
        text += f"[{escape_markdown(title)}]({link}) — {escape_markdown(description)}\n"
    # Добавляем «Лудочат · Переходник» отдельно
    text += "[Лудочат · Переходник](https://t.me/ludoochat) — переходник и резервный чат\n\n"
    # Наши каналы
    text += "**Наши каналы:**\n"
    text += "[Антигембл](https://t.me/antigambl) — канал основателя Лудочата\n"
    text += "[Дневник Лудочата](https://t.me/ludochat_diary) — дневник разработки и развитие сообщества\n\n"
    # Наши боты
    text += "**Наши боты:**\n"
    text += "[Выручат](https://t.me/viruchkaa_bot?start=0012) — чат бота Выручка\n"
    text += "[Выручка](https://t.me/viruchkaa_bot?start=0012) — бот презентующий и реализующий услуги и сервисы для лудоманов: продать аккаунт БК, заработать до 25 000 рублей и много другое\n"
    text += "[Алгоритм](https://t.me/algorithmga_bot?start=0011) — бот для самопомощи при азартно-игровом расстройстве"
    return text
